<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriTech Kenya | Modern Farming Solutions</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        body {
            background-color: #f8faf8;
            color: #1a2e1a;
        }

        /* Header & Navigation */
        .header {
            background: linear-gradient(135deg, #1a4d2a 0%, #2d6a4f 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            cursor: pointer;
        }

        .logo span {
            font-size: 1rem;
            font-weight: 300;
            color: #a8e6b0;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: background 0.3s;
            cursor: pointer;
        }

        .nav-links a:hover {
            background: rgba(255,255,255,0.1);
        }

        .login-btn {
            background: #ffb703;
            color: #1a2e1a !important;
            font-weight: 600 !important;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-email {
            font-size: 0.9rem;
            color: #a8e6b0;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            padding: 0.3rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Main Content */
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
            min-height: 60vh;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=1200');
            background-size: cover;
            background-position: center;
            border-radius: 20px;
            padding: 4rem 3rem;
            color: white;
            margin-bottom: 3rem;
        }

        .hero h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 600px;
            margin-bottom: 2rem;
        }

        .hero-btn {
            background: #ffb703;
            color: #1a2e1a;
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .hero-btn:hover {
            transform: translateY(-2px);
        }

        /* Featured Categories */
        .section-title {
            font-size: 2rem;
            margin-bottom: 2rem;
            color: #1a4d2a;
        }

        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .category-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.3s;
            border: 1px solid #e0f0e0;
            cursor: pointer;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,100,0,0.1);
        }

        .category-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .category-card h3 {
            margin-bottom: 0.5rem;
            color: #1a4d2a;
        }

        .category-card p {
            color: #4a6b4a;
            line-height: 1.6;
        }

        .category-card small {
            color: #2d6a4f;
            font-weight: 600;
        }

        /* Articles Grid */
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .article-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.3s;
            border: 1px solid #e0f0e0;
        }

        .article-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,100,0,0.15);
        }

        .article-image {
            height: 200px;
            background-size: cover;
            background-position: center;
        }

        .article-content {
            padding: 1.5rem;
        }

        .article-category {
            color: #2d6a4f;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .article-title {
            font-size: 1.3rem;
            margin: 0.5rem 0;
            color: #1a2e1a;
        }

        .article-excerpt {
            color: #4a6b4a;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .article-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #6b8f6b;
            font-size: 0.9rem;
        }

        .read-more {
            color: #2d6a4f;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 0.9rem;
        }

        .read-more:hover {
            text-decoration: underline;
        }

        /* Login Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            color: #1a4d2a;
            font-size: 1.5rem;
        }

        .close-btn {
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #1a2e1a;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .login-form input {
            padding: 1rem;
            border: 2px solid #e0f0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .login-form input:focus {
            outline: none;
            border-color: #2d6a4f;
        }

        .login-form input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
        }

        .login-submit {
            background: #1a4d2a;
            color: white;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1rem;
            transition: background 0.3s;
            font-size: 1rem;
        }

        .login-submit:hover:not(:disabled) {
            background: #2d6a4f;
        }

        .login-submit:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .signup-link {
            text-align: center;
            margin-top: 1rem;
            color: #4a6b4a;
        }

        .signup-link span {
            color: #1a4d2a;
            font-weight: 600;
            cursor: pointer;
            text-decoration: underline;
        }

        .error-message {
            color: #d32f2f;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            text-align: center;
            padding: 0.5rem;
            border-radius: 5px;
            background: #ffebee;
        }

        .success-message {
            color: #2d6a4f;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            text-align: center;
            padding: 0.5rem;
            border-radius: 5px;
            background: #e8f5e9;
        }

        /* Admin Dashboard */
        .admin-panel {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e0f0e0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .admin-title {
            font-size: 1.8rem;
            color: #1a4d2a;
        }

        .add-article-btn {
            background: #1a4d2a;
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.3s;
            font-size: 1rem;
        }

        .add-article-btn:hover {
            background: #2d6a4f;
        }

        .article-form {
            background: #f8faf8;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            display: none;
            border: 1px solid #e0f0e0;
        }

        .article-form.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #1a2e1a;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e0f0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2d6a4f;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .submit-btn {
            background: #1a4d2a;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            font-size: 1.1rem;
            transition: background 0.3s;
        }

        .submit-btn:hover {
            background: #2d6a4f;
        }

        .cancel-btn {
            background: #666;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            font-size: 1.1rem;
            margin-top: 1rem;
            transition: background 0.3s;
        }

        .cancel-btn:hover {
            background: #888;
        }

        .admin-articles-list {
            display: grid;
            gap: 1rem;
        }

        .admin-article-item {
            background: #f8faf8;
            padding: 1rem;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e0f0e0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .admin-article-info h4 {
            color: #1a2e1a;
            margin-bottom: 0.3rem;
        }

        .admin-article-info p {
            color: #6b8f6b;
            font-size: 0.9rem;
        }

        .admin-actions {
            display: flex;
            gap: 0.5rem;
        }

        .edit-btn, .delete-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: opacity 0.3s;
            font-size: 0.9rem;
        }

        .edit-btn {
            background: #ffb703;
            color: #1a2e1a;
        }

        .delete-btn {
            background: #d32f2f;
            color: white;
        }

        .edit-btn:hover, .delete-btn:hover {
            opacity: 0.8;
        }

        /* TikTok Teaser Section */
        .tiktok-teaser {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: white;
            padding: 3rem;
            border-radius: 20px;
            margin: 3rem 0;
            text-align: center;
        }

        .tiktok-teaser h3 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .tiktok-teaser p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: #cccccc;
        }

        .tiktok-btn {
            background: #ff0050;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 1rem;
            transition: transform 0.3s;
        }

        .tiktok-btn:hover {
            transform: scale(1.05);
        }

        /* Footer */
        .footer {
            background: #1a2e1a;
            color: white;
            padding: 3rem 2rem 1rem;
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-section h4 {
            margin-bottom: 1rem;
            color: #a8e6b0;
        }

        .footer-section p, .footer-section a {
            color: #cccccc;
            line-height: 1.8;
            text-decoration: none;
            cursor: pointer;
        }

        .footer-section a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid #2d6a4f;
            color: #cccccc;
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1a4d2a;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Quick Post Guide */
        .guide-card {
            background: #e8f5e8;
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            border-left: 4px solid #1a4d2a;
        }

        .guide-card h3 {
            color: #1a4d2a;
            margin-bottom: 1rem;
        }

        .guide-card ol {
            margin-left: 1.5rem;
            color: #1a2e1a;
        }

        .guide-card li {
            margin-bottom: 0.5rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6b8f6b;
        }

        .empty-state p {
            margin-bottom: 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
                gap: 1rem;
            }
            
            .hero {
                padding: 2rem 1.5rem;
            }

            .hero h2 {
                font-size: 1.8rem;
            }
            
            .container {
                padding: 0 1rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }

            .admin-article-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .admin-actions {
                width: 100%;
            }

            .edit-btn, .delete-btn {
                flex: 1;
            }
        }
    </style>
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <div class="logo" onclick="showHome()">
                <h1>AgriTech Kenya</h1>
                <span>Modern Farming Solutions</span>
            </div>
            <div class="nav-links">
                <a onclick="showHome()">Home</a>
                <a onclick="showArticles()">Articles</a>
                <a onclick="showCategories()">Categories</a>
                <div id="auth-section">
                    <a onclick="showLoginModal()" class="login-btn" id="loginButton">Login / Sign Up</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Login to AgriTech Kenya</h2>
                <span class="close-btn" onclick="hideLoginModal()">&times;</span>
            </div>
            <div class="login-form">
                <input type="email" id="email" placeholder="Email Address" required>
                <input type="password" id="password" placeholder="Password" required>
                <div id="messageContainer"></div>
                <button class="login-submit" onclick="handleLogin()" id="loginSubmitBtn">Login</button>
                <div class="signup-link">
                    Don't have an account? <span onclick="toggleAuthMode()" id="toggleAuth">Sign Up</span>
                </div>
            </div>
        </div>
    </div>

    <main class="container" id="main-content">
        <!-- Dynamic content will be loaded here -->
        <div class="spinner"></div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>AgriTech Kenya</h4>
                <p>Empowering Kenyan farmers with modern agricultural technology and sustainable farming practices.</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <p><a onclick="showHome()">Home</a></p>
                <p><a onclick="showArticles()">Articles</a></p>
                <p><a onclick="showCategories()">Categories</a></p>
            </div>
            <div class="footer-section">
                <h4>Contact Info</h4>
                <p>üìç Nairobi, Kenya</p>
                <p>üìß info@agritechkenya.co.ke</p>
                <p>üì± +254 700 000000</p>
            </div>
            <div class="footer-section">
                <h4>Follow Us</h4>
                <p><a href="#" onclick="window.open('https://tiktok.com', '_blank')">TikTok</a></p>
                <p><a href="#" onclick="window.open('https://twitter.com', '_blank')">Twitter</a></p>
                <p><a href="#" onclick="window.open('https://instagram.com', '_blank')">Instagram</a></p>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2026 AgriTech Kenya. All rights reserved. Follow us on TikTok for daily farming tips!</p>
        </div>
    </footer>

    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://qoobmjodvkzldpkbsian.supabase.co';
        const supabaseKey = 'sb_publishable_uRELKaqyZCf4lQfuyG6I1w_EUAWuqIR';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // State
        let articles = [];
        let currentArticle = null;
        let currentUser = null;
        let isLoginMode = true;

        // Check current user on load
        async function checkUser() {
            try {
                const { data: { session }, error } = await supabase.auth.getSession();
                if (error) throw error;
                
                currentUser = session?.user ?? null;
                console.log('Current user:', currentUser);
                updateAuthUI();
                
                // Load articles after checking user
                await loadArticles();
            } catch (error) {
                console.error('Error checking user:', error);
                currentUser = null;
                updateAuthUI();
                await loadArticles();
            }
        }

        // Listen for auth changes
        supabase.auth.onAuthStateChange((event, session) => {
            console.log('Auth state changed:', event, session?.user?.email);
            currentUser = session?.user ?? null;
            updateAuthUI();
            
            if (event === 'SIGNED_IN') {
                hideLoginModal();
                showAdmin(); // Auto-show admin panel after login
            } else if (event === 'SIGNED_OUT') {
                showHome();
            }
        });

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            checkUser();
        });

        // Auth functions
        function showLoginModal() {
            console.log('Showing login modal');
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.add('show');
                // Reset form
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
                document.getElementById('messageContainer').innerHTML = '';
                isLoginMode = true;
                document.getElementById('modalTitle').textContent = 'Login to AgriTech Kenya';
                document.getElementById('loginSubmitBtn').textContent = 'Login';
                document.getElementById('toggleAuth').textContent = 'Sign Up';
            }
        }

        function hideLoginModal() {
            console.log('Hiding login modal');
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.remove('show');
            }
        }

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            document.getElementById('modalTitle').textContent = isLoginMode ? 'Login to AgriTech Kenya' : 'Sign Up for AgriTech Kenya';
            document.getElementById('loginSubmitBtn').textContent = isLoginMode ? 'Login' : 'Sign Up';
            document.getElementById('toggleAuth').textContent = isLoginMode ? 'Sign Up' : 'Login';
            document.getElementById('messageContainer').innerHTML = '';
        }

        async function handleLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const messageContainer = document.getElementById('messageContainer');
            const submitBtn = document.getElementById('loginSubmitBtn');

            if (!email || !password) {
                messageContainer.innerHTML = '<div class="error-message">Please enter both email and password</div>';
                return;
            }

            // Disable button while processing
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';

            try {
                if (isLoginMode) {
                    console.log('Attempting login for:', email);
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email: email,
                        password: password
                    });
                    
                    if (error) throw error;
                    
                    console.log('Login successful:', data.user);
                    messageContainer.innerHTML = '<div class="success-message">Login successful! Redirecting...</div>';
                    
                    // Modal will be hidden by auth state change
                } else {
                    console.log('Attempting signup for:', email);
                    const { data, error } = await supabase.auth.signUp({
                        email: email,
                        password: password
                    });
                    
                    if (error) throw error;
                    
                    console.log('Signup successful:', data);
                    messageContainer.innerHTML = '<div class="success-message">Sign up successful! Please check your email for confirmation.</div>';
                    
                    // Switch to login mode after successful signup
                    setTimeout(() => {
                        isLoginMode = true;
                        document.getElementById('modalTitle').textContent = 'Login to AgriTech Kenya';
                        document.getElementById('loginSubmitBtn').textContent = 'Login';
                        document.getElementById('toggleAuth').textContent = 'Sign Up';
                        document.getElementById('password').value = '';
                    }, 3000);
                }
            } catch (error) {
                console.error('Auth error:', error);
                messageContainer.innerHTML = `<div class="error-message">${error.message}</div>`;
            } finally {
                submitBtn.disabled = false;
                if (isLoginMode) {
                    submitBtn.textContent = 'Login';
                } else {
                    submitBtn.textContent = 'Sign Up';
                }
            }
        }

        async function handleLogout() {
            try {
                await supabase.auth.signOut();
                currentUser = null;
                showHome();
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        function updateAuthUI() {
            const authSection = document.getElementById('auth-section');
            if (currentUser) {
                authSection.innerHTML = `
                    <div class="user-info">
                        <span class="user-email" title="${currentUser.email}">${currentUser.email}</span>
                        <a class="logout-btn" onclick="handleLogout()">Logout</a>
                    </div>
                `;
            } else {
                authSection.innerHTML = '<a onclick="showLoginModal()" class="login-btn" id="loginButton">Login / Sign Up</a>';
            }
        }

        // Navigation functions
        function showHome() {
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <div class="hero">
                    <h2>Modern Farming for the Digital Age</h2>
                    <p>Join thousands of Kenyan "phone-farmers" using technology to revolutionize agriculture. Get expert tips, modern techniques, and connect with certified suppliers.</p>
                    <button class="hero-btn" onclick="showArticles()">Explore Articles ‚Üí</button>
                </div>

                ${!currentUser ? `
                <div class="guide-card">
                    <h3>üìù Quick Start Guide: How to Post Articles</h3>
                    <ol>
                        <li>Click "Login / Sign Up" in the top menu</li>
                        <li>Create an account with your email and password</li>
                        <li>After login, you'll see the Admin Dashboard</li>
                        <li>Click "Add New Article" to start posting</li>
                        <li>Fill in the form with your article details</li>
                        <li>Click "Publish Article" to make it live</li>
                    </ol>
                </div>
                ` : ''}

                <h2 class="section-title">Popular Categories</h2>
                <div class="categories">
                    <div class="category-card" onclick="filterByCategory('Hydroponic')">
                        <div class="category-icon">üå±</div>
                        <h3>Hydroponic Fodder</h3>
                        <p>Learn how to grow nutritious livestock feed without soil, using minimal water and space.</p>
                    </div>
                    <div class="category-card" onclick="filterByCategory('Irrigation')">
                        <div class="category-icon">‚òÄÔ∏è</div>
                        <h3>Smart Irrigation</h3>
                        <p>Solar-powered irrigation systems that save water and reduce electricity costs.</p>
                    </div>
                    <div class="category-card" onclick="filterByCategory('Seeds')">
                        <div class="category-icon">üåΩ</div>
                        <h3>Certified Seeds</h3>
                        <p>Find verified seed suppliers in Nakuru and across Kenya for better yields.</p>
                    </div>
                </div>

                <h2 class="section-title">Latest Articles</h2>
                <div id="home-articles" class="articles-grid">
                    ${renderArticlesList()}
                </div>

                <div class="tiktok-teaser">
                    <h3>üì± Follow Us on TikTok</h3>
                    <p>Get 30-second video teasers of our latest articles and farming tips! Currently the fastest way to get traffic in Kenya without paying for ads.</p>
                    <button class="tiktok-btn" onclick="window.open('https://tiktok.com', '_blank')">
                        <span>üéµ</span> Follow @AgriTechKenya
                    </button>
                </div>
            `;
        }

        function showArticles() {
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <h2 class="section-title">All Articles</h2>
                <div id="all-articles" class="articles-grid">
                    ${renderArticlesList()}
                </div>
            `;
        }

        function showCategories() {
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <h2 class="section-title">Categories</h2>
                <div class="categories">
                    <div class="category-card" onclick="filterByCategory('Hydroponic')">
                        <div class="category-icon">üå±</div>
                        <h3>Hydroponic Fodder</h3>
                        <p>Soil-less farming techniques for livestock feed</p>
                        <small>${articles.filter(a => a.category === 'Hydroponic').length} articles</small>
                    </div>
                    <div class="category-card" onclick="filterByCategory('Irrigation')">
                        <div class="category-icon">üíß</div>
                        <h3>Smart Irrigation</h3>
                        <p>Solar and automated irrigation solutions</p>
                        <small>${articles.filter(a => a.category === 'Irrigation').length} articles</small>
                    </div>
                    <div class="category-card" onclick="filterByCategory('Seeds')">
                        <div class="category-icon">üåΩ</div>
                        <h3>Certified Seeds</h3>
                        <p>Quality seed sources and suppliers</p>
                        <small>${articles.filter(a => a.category === 'Seeds').length} articles</small>
                    </div>
                    <div class="category-card" onclick="filterByCategory('Equipment')">
                        <div class="category-icon">üöú</div>
                        <h3>Farm Equipment</h3>
                        <p>Modern tools and machinery reviews</p>
                        <small>${articles.filter(a => a.category === 'Equipment').length} articles</small>
                    </div>
                </div>
            `;
        }

        function showAdmin() {
            if (!currentUser) {
                showLoginModal();
                return;
            }

            const content = document.getElementById('main-content');
            content.innerHTML = `
                <div class="guide-card">
                    <h3>üìù How to Post an Article</h3>
                    <ol>
                        <li>Click "Add New Article" button below</li>
                        <li>Fill in the title (e.g., "Hydroponic Fodder for Beginners")</li>
                        <li>Select the right category</li>
                        <li>Add an image URL (use Unsplash or your own images)</li>
                        <li>Write a short excerpt (2-3 sentences summary)</li>
                        <li>Write the full article content</li>
                        <li>Add your name as author</li>
                        <li>Set read time (usually 3-7 minutes)</li>
                        <li>Click "Publish Article"</li>
                    </ol>
                </div>

                <div class="admin-panel">
                    <div class="admin-header">
                        <h2 class="admin-title">Admin Dashboard</h2>
                        <button class="add-article-btn" onclick="toggleForm()">
                            <span>+</span> Add New Article
                        </button>
                    </div>

                    <div id="articleForm" class="article-form">
                        <h3 style="margin-bottom: 1.5rem;">${currentArticle ? 'Edit Article' : 'Create New Article'}</h3>
                        <form onsubmit="saveArticle(event)">
                            <div class="form-group">
                                <label>Title *</label>
                                <input type="text" id="title" value="${currentArticle?.title || ''}" placeholder="e.g., Hydroponic Fodder for Beginners" required>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Category *</label>
                                    <select id="category" required>
                                        <option value="">Select a category</option>
                                        <option value="Hydroponic" ${currentArticle?.category === 'Hydroponic' ? 'selected' : ''}>Hydroponic Fodder</option>
                                        <option value="Irrigation" ${currentArticle?.category === 'Irrigation' ? 'selected' : ''}>Smart Irrigation</option>
                                        <option value="Seeds" ${currentArticle?.category === 'Seeds' ? 'selected' : ''}>Certified Seeds</option>
                                        <option value="Equipment" ${currentArticle?.category === 'Equipment' ? 'selected' : ''}>Farm Equipment</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Image URL *</label>
                                    <input type="url" id="image_url" value="${currentArticle?.image_url || ''}" placeholder="https://example.com/image.jpg" required>
                                    <small style="color: #666;">Use Unsplash or your own images</small>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Excerpt * (Short summary)</label>
                                <textarea id="excerpt" rows="2" placeholder="Write a 2-3 sentence summary of your article..." required>${currentArticle?.excerpt || ''}</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Content * (Full article)</label>
                                <textarea id="content" rows="8" placeholder="Write your full article content here..." required>${currentArticle?.content || ''}</textarea>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Author *</label>
                                    <input type="text" id="author" value="${currentArticle?.author || currentUser?.email?.split('@')[0] || 'Admin'}" required>
                                </div>
                                <div class="form-group">
                                    <label>Read Time (minutes) *</label>
                                    <input type="number" id="read_time" value="${currentArticle?.read_time || 5}" min="1" max="30" required>
                                </div>
                            </div>
                            
                            <button type="submit" class="submit-btn">
                                ${currentArticle ? 'Update Article' : 'Publish Article'}
                            </button>
                            ${currentArticle ? '<button type="button" class="cancel-btn" onclick="cancelEdit()">Cancel</button>' : ''}
                        </form>
                    </div>

                    <h3 style="margin: 2rem 0 1rem;">Manage Articles</h3>
                    <div id="adminArticlesList" class="admin-articles-list">
                        ${renderAdminArticlesList()}
                    </div>
                </div>
            `;
        }

        function renderArticlesList() {
            if (articles.length === 0) {
                return '<div class="empty-state"><p>No articles yet. Check back soon!</p></div>';
            }
            
            return articles.map(article => `
                <div class="article-card">
                    <div class="article-image" style="background-image: url('${article.image_url || 'https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=400'}')"></div>
                    <div class="article-content">
                        <div class="article-category">${article.category}</div>
                        <h3 class="article-title">${article.title}</h3>
                        <p class="article-excerpt">${article.excerpt}</p>
                        <div class="article-meta">
                            <span>${article.author} ‚Ä¢ ${article.read_time} min read</span>
                            <button class="read-more" onclick="viewArticle('${article.id}')">Read More ‚Üí</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderAdminArticlesList() {
            if (articles.length === 0) {
                return '<p class="empty-state">No articles yet. Click "Add New Article" to create one.</p>';
            }
            
            return articles.map(article => `
                <div class="admin-article-item">
                    <div class="admin-article-info">
                        <h4>${article.title}</h4>
                        <p>${article.category} ‚Ä¢ ${article.author} ‚Ä¢ ${article.read_time} min read</p>
                    </div>
                    <div class="admin-actions">
                        <button class="edit-btn" onclick="editArticle('${article.id}')">Edit</button>
                        <button class="delete-btn" onclick="deleteArticle('${article.id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Supabase CRUD operations
        async function loadArticles() {
            try {
                const { data, error } = await supabase
                    .from('articles')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                articles = data || [];
                console.log('Loaded articles:', articles.length);
                refreshViews();
            } catch (error) {
                console.error('Error loading articles:', error);
            }
        }

        async function saveArticle(event) {
            event.preventDefault();
            
            if (!currentUser) {
                alert('Please login first');
                showLoginModal();
                return;
            }

            const articleData = {
                title: document.getElementById('title').value,
                category: document.getElementById('category').value,
                image_url: document.getElementById('image_url').value,
                excerpt: document.getElementById('excerpt').value,
                content: document.getElementById('content').value,
                author: document.getElementById('author').value,
                read_time: parseInt(document.getElementById('read_time').value),
                user_id: currentUser.id
            };

            try {
                if (currentArticle) {
                    // Update existing article
                    const { error } = await supabase
                        .from('articles')
                        .update(articleData)
                        .eq('id', currentArticle.id);
                    
                    if (error) throw error;
                    alert('Article updated successfully!');
                } else {
                    // Create new article
                    const { error } = await supabase
                        .from('articles')
                        .insert([articleData]);
                    
                    if (error) throw error;
                    alert('Article published successfully!');
                }
                
                // Reset form and reload
                currentArticle = null;
                toggleForm();
                await loadArticles();
                showAdmin();
            } catch (error) {
                console.error('Error saving article:', error);
                alert('Error saving article: ' + error.message);
            }
        }

        async function deleteArticle(id) {
            if (!currentUser) {
                alert('Please login first');
                return;
            }

            if (!confirm('Are you sure you want to delete this article?')) return;
            
            try {
                const { error } = await supabase
                    .from('articles')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                alert('Article deleted successfully!');
                await loadArticles();
                refreshViews();
            } catch (error) {
                console.error('Error deleting article:', error);
                alert('Error deleting article: ' + error.message);
            }
        }

        function editArticle(id) {
            if (!currentUser) {
                showLoginModal();
                return;
            }
            currentArticle = articles.find(a => a.id === id);
            showAdmin();
            document.getElementById('articleForm').classList.add('show');
        }

        function viewArticle(id) {
            const article = articles.find(a => a.id === id);
            if (!article) return;
            
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <div style="max-width: 800px; margin: 0 auto;">
                    <button onclick="showArticles()" style="background: none; border: none; color: #2d6a4f; font-size: 1rem; cursor: pointer; margin-bottom: 2rem;">‚Üê Back to Articles</button>
                    <div style="background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                        <div style="color: #2d6a4f; font-weight: 600; margin-bottom: 1rem;">${article.category}</div>
                        <h1 style="font-size: 2.5rem; color: #1a2e1a; margin-bottom: 1rem;">${article.title}</h1>
                        <div style="display: flex; gap: 2rem; color: #6b8f6b; margin-bottom: 2rem; flex-wrap: wrap;">
                            <span>By ${article.author}</span>
                            <span>${article.read_time} min read</span>
                        </div>
                        <img src="${article.image_url}" alt="${article.title}" style="width: 100%; height: 400px; object-fit: cover; border-radius: 15px; margin-bottom: 2rem;">
                        <div style="line-height: 1.8; color: #1a2e1a; white-space: pre-line;">
                            ${article.content}
                        </div>
                    </div>
                    
                    <!-- Affiliate Links Section -->
                    <div style="background: #f8faf8; padding: 2rem; border-radius: 20px; margin-top: 2rem; border: 1px solid #e0f0e0;">
                        <h3 style="color: #1a4d2a; margin-bottom: 1rem;">Recommended Equipment</h3>
                        <p style="color: #4a6b4a; margin-bottom: 1.5rem;">Support us by purchasing through our affiliate links:</p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                            <div style="background: white; padding: 1rem; border-radius: 10px;">
                                <h4>Hydroponic System Kit</h4>
                                <p style="color: #2d6a4f; font-weight: 600;">KSh 15,000</p>
                                <button style="background: #ffb703; color: #1a2e1a; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; width: 100%;" onclick="window.open('https://kilimall.co.ke', '_blank')">Buy on Kilimall</button>
                            </div>
                            <div style="background: white; padding: 1rem; border-radius: 10px;">
                                <h4>Solar Irrigation Pump</h4>
                                <p style="color: #2d6a4f; font-weight: 600;">KSh 25,000</p>
                                <button style="background: #ffb703; color: #1a2e1a; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; width: 100%;" onclick="window.open('https://kilimall.co.ke', '_blank')">Buy on Kilimall</button>
                            </div>
                            <div style="background: white; padding: 1rem; border-radius: 10px;">
                                <h4>Certified Seed Pack</h4>
                                <p style="color: #2d6a4f; font-weight: 600;">KSh 3,500</p>
                                <button style="background: #ffb703; color: #1a2e1a; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; width: 100%;" onclick="alert('Contact our partner agrovet in Nakuru for certified seeds')">Contact Agrovet</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function toggleForm() {
            const form = document.getElementById('articleForm');
            if (form) {
                form.classList.toggle('show');
                if (!form.classList.contains('show')) {
                    currentArticle = null;
                }
            }
        }

        function cancelEdit() {
            currentArticle = null;
            toggleForm();
        }

        function filterByCategory(category) {
            const filteredArticles = articles.filter(a => a.category === category);
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <h2 class="section-title">${category} Articles</h2>
                <div class="articles-grid">
                    ${filteredArticles.map(article => `
                        <div class="article-card">
                            <div class="article-image" style="background-image: url('${article.image_url || 'https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=400'}')"></div>
                            <div class="article-content">
                                <div class="article-category">${article.category}</div>
                                <h3 class="article-title">${article.title}</h3>
                                <p class="article-excerpt">${article.excerpt}</p>
                                <div class="article-meta">
                                    <span>${article.author} ‚Ä¢ ${article.read_time} min read</span>
                                    <button class="read-more" onclick="viewArticle('${article.id}')">Read More ‚Üí</button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <button onclick="showCategories()" style="background: none; border: none; color: #2d6a4f; font-size: 1rem; cursor: pointer; margin-top: 1rem;">‚Üê Back to Categories</button>
            `;
        }

        function refreshViews() {
            // Refresh current view based on what's showing
            const content = document.getElementById('main-content');
            if (content.querySelector('.admin-panel')) {
                showAdmin();
            } else if (content.querySelector('.categories') && !content.querySelector('.articles-grid')) {
                showCategories();
            } else if (content.querySelector('.hero')) {
                showHome();
            } else {
                showArticles();
            }
        }

        // Make functions globally available
        window.showHome = showHome;
        window.showArticles = showArticles;
        window.showCategories = showCategories;
        window.showAdmin = showAdmin;
        window.showLoginModal = showLoginModal;
        window.hideLoginModal = hideLoginModal;
        window.toggleAuthMode = toggleAuthMode;
        window.handleLogin = handleLogin;
        window.handleLogout = handleLogout;
        window.viewArticle = viewArticle;
        window.filterByCategory = filterByCategory;
        window.editArticle = editArticle;
        window.deleteArticle = deleteArticle;
        window.toggleForm = toggleForm;
        window.cancelEdit = cancelEdit;
    </script>
</body>
</html>
